# Тесты для Pinia-хранилищ

## Общая информация

В этой директории находятся юнит-тесты для хранилищ состояния приложения, созданных с использованием Pinia. Тесты написаны с использованием Vitest и охватывают основные функции хранилищ, включая их состояние, геттеры и действия.

## Структура тестов

- `setup.ts` - вспомогательный файл для установки Pinia в тестовом окружении
- `useAuthStore.spec.ts` - тесты для хранилища аутентификации
- `useAssistantsStore.spec.ts` - тесты для хранилища списка ассистентов
- `useAssistantChatStore.spec.ts` - тесты для хранилища чата с ассистентами
- `useWebhookChatStore.spec.ts` - тесты для хранилища чата через вебхуки
- `useLayoutStore.spec.ts` - тесты для хранилища состояния интерфейса
- `useFAQStore.spec.ts` - тесты для хранилища часто задаваемых вопросов

## Мокированные сервисы

Для изоляции тестов используются мокированные API-сервисы, расположенные в `tests/__mocks__/@/api/services`:

- `authService.ts` - мок сервиса аутентификации
- `agentService.ts` - мок сервиса работы с ассистентами
- `webhookService.ts` - мок сервиса для работы с вебхуками

## Запуск тестов

Для запуска тестов хранилищ используйте следующую команду:

```bash
npm run test:unit
```

Для запуска тестов с покрытием:

```bash
npm run test:coverage
```

## Принципы тестирования хранилищ

1. **Изоляция** - каждый тест работает с новым экземпляром хранилища, который создается перед каждым тестом.
2. **Мокирование зависимостей** - все внешние зависимости (API-сервисы, localStorage и т.д.) мокируются.
3. **Проверка состояния** - проверяется начальное состояние и изменения состояния после выполнения действий.
4. **Проверка действий** - тестируется корректность работы действий хранилища, включая обработку успешных и ошибочных ответов API.
5. **Проверка геттеров** - тестируется корректность работы геттеров хранилища.

## Типовая структура теста хранилища

```typescript
import { describe, it, expect, beforeEach, afterEach, vi } from 'vitest';
import { useStore } from '@/stores/useStore';
import { setupPiniaForTesting } from './setup';

describe('useStore', () => {
  beforeEach(() => {
    setupPiniaForTesting();
    // Дополнительная настройка для теста
  });
  
  afterEach(() => {
    vi.restoreAllMocks();
  });
  
  describe('state', () => {
    it('должен иметь правильное начальное состояние', () => {
      const store = useStore();
      // Проверки начального состояния
    });
  });
  
  describe('actions', () => {
    it('должен корректно выполнять действие', async () => {
      const store = useStore();
      // Выполнение действия
      // Проверка результата
    });
    
    it('должен обрабатывать ошибки', async () => {
      // Мокирование ошибки
      // Выполнение действия
      // Проверка обработки ошибки
    });
  });
  
  describe('getters', () => {
    it('должен корректно возвращать данные', () => {
      const store = useStore();
      // Настройка состояния
      // Проверка геттера
    });
  });
}); 